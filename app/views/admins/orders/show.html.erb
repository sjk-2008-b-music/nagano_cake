<div class="body">
  <div class="container">
    <h3>注文履歴詳細</h3>

    <div class="row title">
      <div>
        <label class="col-xs-2">購入者</label>
        <div class="col-xs-10">
          <%= link_to admins_end_user_path(@order.end_user) do %>
            <%= @order.end_user.last_name %>
              <%= @order.end_user.first_name %>
                <% end %>
        </div>
      </div>

      <div>
        <label class="col-xs-2">配送先</label>
        <div class="col-xs-10">
          <%= @order.address + @order.name %>
        </div>
      </div>

      <div>
        <label class="col-xs-2">支払い方法</label>
        <div class="col-xs-10">
          <%= @order.payment_method %>
        </div>
      </div>

      <div>
        <label class="col-xs-2">注文ステータス</label>
        <div class="col-xs-10">
          <%= form_for(@order,url: {controller: "orders", action: "update"}) do |f| %>
            <%= f.select :status, Order.statuses.keys.to_a, {} %>
              <%= f.submit '更新' %>
                <% end %>
        </div>
      </div>
    </div>

    <div class="row title">
      <div class="col-xs-8">
        <table class="table table-inverse panel panel-default">
          <thead>
            <tr>
              <th>商品名</th>
              <th>単価(税込)</th>
              <th>数量</th>
              <th>小計</th>
              <th>製作ステータス</th>
            </tr>
          </thead>
          <tbody>
            <% @order_details.each do |order_detail| %>
              <tr>
                <td>
                  <%= order_detail.item.name %>
                </td>
                <td>
                  <%= order_detail.price %>
                </td>
                <td>
                  <%= order_detail.amount %>
                </td>
                <td>
                  <%= order_detail.total_price %>
                </td>
                <td>
                  <%= form_for order_detail,url: admins_order_detail_path(order_detail.id) do |f| %>
                    <%= f.select :making_status, OrderDetail.making_statuses.keys.to_a, {} %>
                      <%= f.submit '更新' %>
                        <% end %>
                </td>
              </tr>
              <% end %>
          </tbody>
        </table>
      </div>

      <div class="col-xs-4">
        <div>
          <label class="col-xs-4">商品合計</label>
          <div class="col-xs-8">
            <% @sum = 0 %>
              <% @order_details.each do |order_detail| %>
                <% @sum += order_detail.total_price %>
                  <% end %>
                    <%= @sum %>
          </div>
        </div>
        <div>
          <label class="col-xs-4">送料</label>
          <div class="col-xs-8">
            <%= @order.shipping_cost %>
          </div>
        </div>

        <div>
          <label class="col-xs-4">請求金額合計</label>
          <div class="col-xs-8">
            <%= @sum = @sum + @order.shipping_cost %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
